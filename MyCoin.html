<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>MyCustomCoin DApp</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f6f9; display: flex; justify-content: center; padding-top: 40px; }
        .container { width: 420px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 0 20px rgba(0,0,0,0.1) }
        h2 { text-align: center; }
        .card { background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .label { font-size: 12px; color: #666; }
        .value { font-weight: bold; font-size: 16px; word-break: break-all }
        input { width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #ccc;}
        button { width: 100%; padding: 13px; font-weight: bold; border-radius: 6px; cursor: pointer; transition: .3s; color: #fff; border: none; }
        .btn-blue { background:#007bff; } .btn-blue:hover { background:#0056b3; }
        .btn-green { background:#28a745; } .btn-green:hover { background:#1e7e34; }
        .status { text-align:center; font-weight:bold; margin-top:10px; font-size:14px; }
        .text-success { color:green; }
        .text-danger { color:red; }
        .text-warning { color:orange; }
    </style>
</head>
<body>

<div class="container">
    <h2>MyCustomCoin Wallet</h2>

    <div class="card">
        <span class="label">Bağlı Cüzdan:</span>
        <div id="walletAddress" class="value">Bağlı değil</div>
        <button class="btn-blue" id="connectBtn" onclick="connectWallet()">MetaMask'a Bağlan</button>
    </div>

    <div class="card">
        <span class="label">Bakiye:</span>
        <div id="balanceDisplay" class="value">0 MCC</div>
        <button class="btn-blue" style="background:#6c757d" onclick="updateBalance()">Yenile</button>
    </div>

    <div class="card">
        <span class="label">Alıcı Adresi</span>
        <input id="receiverAddress" placeholder="0x...">

        <span class="label">Gönderilecek Miktar</span>
        <input id="amount" type="number" min="0" placeholder="0">

        <button class="btn-green" onclick="sendToken()">Gönder</button>
        <div id="statusMessage" class="status"></div>
    </div>
</div>

<script>
    const CONTRACT_ADDRESS = "0x4D8bC474A92e189be27850871df5FF9f2706b05C"; 
    const BALANCE_SELECTOR = "0x70a08231";
    const TRANSFER_SELECTOR = "0xa9059cbb";
    const DECIMALS = 18;
    
    let userAccount = null;

    async function connectWallet() {
        if (!window.ethereum) return alert("MetaMask gerekli!");

        try {
            const accounts = await ethereum.request({ method: "eth_requestAccounts" });
            userAccount = accounts[0];

            document.getElementById("walletAddress").textContent = userAccount;
            document.getElementById("connectBtn").textContent = "Bağlandı";
            document.getElementById("connectBtn").style.background = "#28a745";
            document.getElementById("connectBtn").disabled = true;

            updateBalance();

        } catch {
            alert("Bağlantı reddedildi!");
        }
    }

    async function updateBalance() {
        if (!userAccount) return;

        const padded = userAccount.substring(2).padStart(64, "0");
        const data = BALANCE_SELECTOR + padded;

        try {
            const result = await ethereum.request({
                method: "eth_call",
                params: [{ to: CONTRACT_ADDRESS, data }]
            });

            const balance = BigInt(result) / BigInt(10 ** DECIMALS);
            document.getElementById("balanceDisplay").textContent = balance + " MCC";

        } catch (error) {
            console.error(error);
            alert("Bakiye alınamadı!");
        }
    }

    async function sendToken() {
        if (!userAccount) return alert("Önce MetaMask'a bağlan!");

        let to = document.getElementById("receiverAddress").value.trim();
        let amount = document.getElementById("amount").value;

        if (!to.startsWith("0x") || to.length !== 42) return alert("Adres hatalı!");
        if (amount <= 0) return alert("Miktar yanlış!");

        const weiAmount = BigInt(amount) * BigInt(10 ** DECIMALS);
        const encodedValue = weiAmount.toString(16).padStart(64, "0");
        const encodedReceiver = to.substring(2).padStart(64, "0");

        const data = TRANSFER_SELECTOR + encodedReceiver + encodedValue;

        document.getElementById("statusMessage").textContent = "MetaMask onayı bekleniyor...";
        document.getElementById("statusMessage").className = "status text-warning";

        try {
            const tx = await ethereum.request({
                method: "eth_sendTransaction",
                params: [{ from: userAccount, to: CONTRACT_ADDRESS, data }]
            });

            document.getElementById("statusMessage").textContent = "Başarılı ➜ TX: " + tx.slice(0,10) + "...";
            document.getElementById("statusMessage").className = "status text-success";

            setTimeout(updateBalance, 4000);

        } catch (err) {
            document.getElementById("statusMessage").textContent = "Hata: " + err.message;
            document.getElementById("statusMessage").className = "status text-danger";
        }
    }
</script>

</body>
</html>
